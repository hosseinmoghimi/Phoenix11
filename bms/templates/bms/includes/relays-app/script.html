<script>
    let relays_for_relays_app = JSON.parse(`{{relays_s|escapejs}}`)
    // let relays = JSON.parse(`{{relays_s|escapejs}}`)
    let relays_app = new Vue({
        el:"#relays-app",
        data: {
            relays: relays_for_relays_app,
            search_for:'',
            waiting:false,
        },
        methods: {
            filter:function(){
                this.relays = relays_for_relays_app.filter(relay => relay.name.indexOf(this.search_for) > -1)
         
            },
            execute_command:function(command){
                let command_id=command.id
                let url = "{% url 'bms:execute_command' %}"
                let payload = {
                    csrfmiddlewaretoken: csrfmiddlewaretoken,
                    command_id: command_id,
                }

                $.post(url, payload).done(data => {
                    console.log(data)
                    if (data.result === 'SUCCEED') {
                        relays_app.relays.forEach(relay => {
                            data.registers.forEach(register => {
                                    if(relay.register==register.register)
                                        relay.state=register.state
                                });
                        });
                    }
                })
            },
            to_price: function (vall) {
                let color='primary'
                if (vall<0)
                color='danger'
                if (vall>0)
                color='success'
                vall=to_price(vall,"{{CURRENCY}}")
                return `
                    <span class="text-${color}">${vall}</span>
                    `
            },
            
           
        }
    })

</script>